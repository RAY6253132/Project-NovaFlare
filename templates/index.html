<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>NovaFlare</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background-color: #1a1a2e;
            color: white;
            overflow: hidden; /* Prevent body scroll */
            position: relative;
            background-size: cover;
            background-position: center;
            background-image: url('/static/novaflare_bg.png'); /* Global background for the game */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-app-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 5rem); /* Account for bottom nav bar height */
            background: rgba(0, 0, 0, 0.6); /* Overlay for the whole game container */
            backdrop-filter: blur(5px);
            position: relative; /* For absolute positioning of profile icon */
        }

        /* Home Screen specific container */
        .home-screen-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            text-align: center;
        }

        /* Profile Icon in top-left */
        .profile-icon-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 20; /* Above other content but below side menu */
        }
        .profile-icon-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #a78bfa; /* Purple border */
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            transition: transform 0.2s ease;
            cursor: pointer;
            background-color: #3a3a5e; /* Fallback background */
        }
        .profile-icon-button:hover {
            transform: scale(1.05);
        }
        .profile-icon-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Bottom Navigation Bar */
        .bottom-nav-bar {
            display: flex;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.5rem 0;
            z-index: 100;
            position: fixed;
            bottom: 0;
            width: 100%;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.5);
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem; /* Slightly larger font */
            color: #ccc;
            text-decoration: none;
            cursor: pointer;
            padding: 0.5rem 0.25rem; /* More padding for touch targets */
            transition: color 0.2s ease, background-color 0.2s ease;
            border-radius: 8px;
        }
        .nav-item:hover {
            color: #a78bfa; /* Purple hover */
            background-color: rgba(255, 255, 255, 0.05);
        }
        .nav-item.active {
            color: #818cf8; /* Blue-purple active color */
            font-weight: bold;
        }
        .nav-item svg { /* Styling for Lucide-like SVG icons */
            width: 28px;
            height: 28px;
            margin-bottom: 4px;
        }

        /* Profile UI (Side Menu) */
        .profile-ui-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 150;
        }
        .profile-ui-content {
            position: absolute;
            top: 0;
            right: 0;
            width: 80%; /* Adjust as needed for mobile */
            max-width: 350px; /* Max width for larger screens */
            height: 100%;
            background: #2a2a44; /* Darker background for the menu */
            box-shadow: -8px 0 20px rgba(0,0,0,0.6);
            transform: translateX(100%); /* Start off-screen */
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            box-sizing: border-box;
        }
        .profile-ui-overlay.open .profile-ui-content {
            transform: translateX(0); /* Slide in */
        }
        .profile-ui-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1.5rem;
        }
        .profile-ui-close-btn {
            background: none;
            border: none;
            color: #ccc;
            font-size: 2rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .profile-ui-close-btn:hover {
            color: white;
        }
        .profile-info {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .profile-info img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid #818cf8;
            margin-right: 1rem;
        }
        .profile-info-text h3 {
            font-size: 1.2rem;
            font-weight: bold;
            color: #818cf8;
        }
        .profile-info-text p {
            font-size: 0.9rem;
            color: #ccc;
        }
        .profile-menu-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 0.5rem; /* For scrollbar space */
        }
        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            font-size: 1rem;
            font-weight: 500;
            color: white;
        }
        .profile-menu-item:hover {
            background-color: rgba(0, 0, 0, 0.5);
            transform: translateX(5px);
        }
        .profile-menu-item svg {
            margin-right: 0.75rem;
            width: 20px;
            height: 20px;
        }
        .profile-menu-separator {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 1.5rem 0;
        }

        /* Global Notification */
        .global-notification {
            position: fixed;
            bottom: 7rem; /* Above bottom nav bar */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 123, 255, 0.9); /* Blue color */
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 200;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }
        .global-notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-10px); /* Slight lift effect */
        }

        /* Utility for hiding scrollbar */
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera*/
        }

    </style>
</head>
<body>
    <div class="main-app-container">
        <!-- Profile Icon in top-left corner -->
        <div class="profile-icon-container">
            <button id="profileIconButton" class="profile-icon-button" onclick="openProfileUI()">
                <img src="https://placehold.co/60x60/808080/FFFFFF?text=AV" alt="Profile Icon">
            </button>
        </div>

        <!-- Home Screen Main Content -->
        <div class="home-screen-content">
            <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-300 drop-shadow-lg">
                Welcome, Astral Voyager!
            </h1>
            <p class="text-lg text-gray-300 mt-4">Explore the NovaFlare Universe.</p>
            <!-- Placeholder for dynamic content or events -->
            <div class="mt-8 p-4 bg-gray-800/50 rounded-lg border border-gray-700 w-full max-w-md text-center">
                <h2 class="text-xl font-bold mb-2">Current Event</h2>
                <p class="text-gray-400">"Cosmic Convergence" - Ends in 3 days!</p>
            </div>
        </div>

        <!-- Bottom Navigation Bar -->
        <div class="bottom-nav-bar">
            <a href="/" class="nav-item active">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span>Home</span>
            </a>
            <a href="/shop" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                <span>Shop</span>
            </a>
            <a href="/game" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                <span>Gacha</span>
            </a>
            <a href="#" class="nav-item" onclick="showDevelopmentMessage('Characters')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <span>Characters</span>
            </a>
            <a href="#" class="nav-item" onclick="showDevelopmentMessage('Inventory')">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-backpack"><path d="M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4"/><path d="M2 10v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6"/><path d="M10 18v-2a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2"/></svg>
                <span>Inventory</span>
            </a>
        </div>
    </div>

    <!-- Profile UI Overlay -->
    <div id="profileUIOverlay" class="profile-ui-overlay" onclick="closeProfileUI(event)">
        <div class="profile-ui-content" onclick="event.stopPropagation()">
            <div class="profile-ui-header">
                <button class="profile-ui-close-btn" onclick="closeProfileUI()">&times;</button>
            </div>
            <div class="profile-info">
                <img id="profile-avatar" src="https://placehold.co/70x70/818cf8/FFFFFF?text=AV" alt="Player Avatar">
                <div class="profile-info-text">
                    <h3 id="player-name">Player Name</h3>
                    <p>UID: <span id="player-uid">Loading...</span></p>
                    <p>Transcension Level: <span id="transcension-level">0</span></p>
                </div>
            </div>
            <div class="profile-menu-list hide-scrollbar">
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Daily Login')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-check"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m9 16 2 2 4-4"/></svg>
                    Daily Login
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Monthly Pass')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-credit-card"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                    Monthly Pass
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Team')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Team
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Mail')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-mail"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                    Mail
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Announcements')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone"><path d="m3 11 18-2v7l-18 2V11z"/><path d="M7 7v11"/><path d="M22 9v4"/><path d="M22 12H11"/></svg>
                    Announcements
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Events')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days"><rect width="18" height="18" x="3" y="4" rx="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                    Events
                </div>
                <div class="profile-menu-item" onclick="showDevelopmentMessage('Settings')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.78 1.28a2 2 0 0 0 .73 2.73l.04.02a2 2 0 0 1 .97 1.95v.44a2 2 0 0 1-.97 1.95l-.04.02a2 2 0 0 0-.73 2.73l.78 1.28a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.78-1.28a2 2 0 0 0-.73-2.73l-.04-.02a2 2 0 0 1-.97-1.95v-.44a2 2 0 0 1 .97-1.95l.04-.02a2 2 0 0 0 .73-2.73l-.78-1.28a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    Settings
                </div>
                <div class="profile-menu-separator"></div>
                <div class="profile-menu-item" onclick="window.location.href='/logout'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="17 16 22 12 17 8"/><line x1="22" x2="10" y1="12" y2="12"/></svg>
                    Logout
                </div>
            </div>
        </div>
    </div>

    <!-- Global Notification Element -->
    <div id="globalNotification" class="global-notification"></div>
    
    <script>
        // Check if Telegram WebApp is available
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            // Set the background color to match your app's theme
            Telegram.WebApp.setBackgroundColor('#1a1a2e');
            // Hide the bottom app close button as we have our own navigation
            Telegram.WebApp.closeButton.hide();
        }

        // Function to show a custom notification (replaces alert)
        function showGlobalNotification(message, duration = 3000) {
            const notification = document.getElementById('globalNotification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function showDevelopmentMessage(featureName) {
            showGlobalNotification(`${featureName} feature is currently in development.`);
        }

        // Profile UI functions
        function openProfileUI() {
            document.getElementById('profileUIOverlay').style.display = 'flex';
            // Trigger reflow to ensure transition plays
            void document.getElementById('profileUIOverlay').offsetWidth; 
            document.getElementById('profileUIOverlay').classList.add('open');
            fetchProfileData(); // Fetch user data when opening profile
        }

        function closeProfileUI(event) {
            // Only close if clicking on the overlay itself, not the content
            if (event && event.target !== document.getElementById('profileUIOverlay')) {
                return;
            }
            document.getElementById('profileUIOverlay').classList.remove('open');
            setTimeout(() => {
                document.getElementById('profileUIOverlay').style.display = 'none';
            }, 300); // Match CSS transition duration
        }

        function fetchProfileData() {
            const initData = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp.initData : null;
            if (!initData) {
                console.error("Telegram init data is not available for profile.");
                document.getElementById('player-uid').innerText = 'N/A';
                document.getElementById('player-name').innerText = 'Guest Player';
                document.getElementById('transcension-level').innerText = '0';
                return;
            }

            fetch('/get_user_data', {
                method: 'GET',
                headers: { 'X-Telegram-Init-Data': initData }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    document.getElementById('player-uid').innerText = data.user_id;
                    // Assuming you might have a 'username' or 'player_name' in your user data
                    document.getElementById('player-name').innerText = data.username || 'Astral Voyager'; 
                    // Assuming 'transcension_level' might be part of your user data
                    document.getElementById('transcension-level').innerText = data.transcension_level || '1'; 
                } else {
                    console.error("Failed to fetch profile data:", data.message);
                    showGlobalNotification(`Error loading profile: ${data.message}`);
                }
            })
            .catch(error => {
                console.error("Error fetching profile data:", error);
                showGlobalNotification("Network error loading profile. Please try again.");
            });
        }

        // Initial fetch for profile data when the page loads (optional, but good for consistency)
        document.addEventListener('DOMContentLoaded', fetchProfileData);
    </script>
</body>
</html>
